<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LFG Bridge - Найди тиммейтов</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Сброс и базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }

        body {
            background-color: #0f0f23;
            color: #e6e6e6;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Контейнер приложения */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Стили для экранов приложения */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

            .screen.active {
                display: block;
            }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Заголовки */
        h1, h2, h3 {
            color: #6ab7ff;
            margin-bottom: 15px;
            font-weight: 600;
        }

        h1 {
            font-size: 28px;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 22px;
        }

        h3 {
            font-size: 18px;
            color: #9acdff;
        }

        /* Карточки */
        .card {
            background-color: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid #2a2a3e;
        }

        /* Кнопки */
        .btn {
            display: inline-block;
            background-color: #2d7bd4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: all 0.2s ease;
            margin: 5px;
            width: calc(100% - 10px);
        }

            .btn:hover {
                background-color: #3a8be8;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .btn:active {
                transform: translateY(0);
            }

        .btn-secondary {
            background-color: #4a4a6a;
        }

            .btn-secondary:hover {
                background-color: #5a5a7a;
            }

        .btn-success {
            background-color: #2e7d32;
        }

            .btn-success:hover {
                background-color: #3d8b40;
            }

        .btn-danger {
            background-color: #c62828;
        }

            .btn-danger:hover {
                background-color: #d32f2f;
            }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        /* Группы кнопок */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

            .button-group .btn {
                flex: 1;
                margin: 0;
            }

        /* Шаги анкеты */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

            .step-indicator::before {
                content: '';
                position: absolute;
                top: 15px;
                left: 0;
                right: 0;
                height: 2px;
                background-color: #4a4a6a;
                z-index: 1;
            }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            position: relative;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #4a4a6a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            border: 3px solid #1a1a2e;
        }

        .step.active .step-circle {
            background-color: #2d7bd4;
        }

        .step.completed .step-circle {
            background-color: #2e7d32;
        }

        .step-label {
            font-size: 12px;
            text-align: center;
            color: #aaa;
        }

        .step.active .step-label {
            color: #6ab7ff;
        }

        /* Опции выбора */
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .option {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background-color: #2a2a3e;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

            .option:hover {
                background-color: #3a3a4e;
            }

            .option.selected {
                background-color: #1e3a5f;
                border-color: #2d7bd4;
                color: #6ab7ff;
            }

        /* Списки */
        .player-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .player-card {
            background-color: #2a2a3e;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

            .player-card:hover {
                background-color: #3a3a4e;
                transform: translateY(-2px);
            }

        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #4a4a6a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            margin-right: 15px;
            color: #6ab7ff;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .player-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 14px;
            color: #aaa;
        }

        .player-detail {
            background-color: #1a1a2e;
            padding: 3px 8px;
            border-radius: 12px;
        }

        /* Нижняя панель навигации */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1a1a2e;
            border-top: 1px solid #2a2a3e;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            text-decoration: none;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

            .nav-item:hover {
                background-color: #2a2a3e;
            }

            .nav-item.active {
                color: #6ab7ff;
            }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* Формы */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        /* Адаптивность */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 24px;
            }

            .option {
                min-width: 100px;
            }

            .button-group {
                flex-direction: column;
            }
        }

        /* Статус */
        .status {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

            .status.success {
                background-color: rgba(46, 125, 50, 0.2);
                color: #81c784;
                border: 1px solid #2e7d32;
            }

            .status.info {
                background-color: rgba(33, 150, 243, 0.2);
                color: #64b5f6;
                border: 1px solid #2196f3;
            }

            .status.warning {
                background-color: rgba(255, 152, 0, 0.2);
                color: #ffb74d;
                border: 1px solid #ff9800;
            }

        /* Загрузчик */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(106, 183, 255, 0.3);
            border-radius: 50%;
            border-top-color: #6ab7ff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none;
        }

        /* Приветственный экран */
        .welcome-screen {
            text-align: center;
            padding-top: 40px;
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #6ab7ff;
        }

        .welcome-text {
            font-size: 18px;
            margin-bottom: 30px;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Экран приветствия -->
        <div id="welcome-screen" class="screen active">
            <div class="welcome-screen">
                <div class="welcome-icon">🎮</div>
                <h1>Добро пожаловать в LFG Bridge!</h1>
                <p class="welcome-text">Найди идеальных тиммейтов для совместной игры в Dota 2, CS:GO и Valorant</p>
                <div class="card">
                    <p>Создай анкету, чтобы другие игроки могли найти тебя по твоим предпочтениям и уровню игры.</p>
                    <button id="start-btn" class="btn">Начать</button>
                </div>
            </div>
        </div>

        <!-- Экран анкеты -->
        <div id="form-screen" class="screen">
            <h2>Создание анкеты</h2>

            <!-- Индикатор шагов -->
            <div class="step-indicator">
                <div class="step active" id="step-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Игра</div>
                </div>
                <div class="step" id="step-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Ранг</div>
                </div>
                <div class="step" id="step-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Роль</div>
                </div>
                <div class="step" id="step-4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Цель</div>
                </div>
            </div>

            <!-- Шаг 1: Выбор игры -->
            <div id="form-step-1" class="form-step">
                <div class="card">
                    <h3>Выберите игру</h3>
                    <p>В какую игру вы ищете тиммейтов?</p>
                    <div class="options">
                        <div class="option" data-value="dota2">Dota 2</div>
                        <div class="option" data-value="csgo">CS:GO</div>
                        <div class="option" data-value="valorant">Valorant</div>
                    </div>
                </div>
            </div>

            <!-- Шаг 2: Выбор ранга -->
            <div id="form-step-2" class="form-step hidden">
                <div class="card">
                    <h3>Ваш уровень игры</h3>
                    <p>Выберите свой ранг или уровень</p>
                    <div class="options" id="rank-options">
                        <!-- Опции рангов будут заполнены JavaScript -->
                        <div class="status warning">Сначала выберите игру на шаге 1</div>
                    </div>
                </div>
            </div>

            <!-- Шаг 3: Выбор роли -->
            <div id="form-step-3" class="form-step hidden">
                <div class="card">
                    <h3>Предпочитаемая роль</h3>
                    <p>Какую роль вы обычно играете?</p>
                    <div class="options" id="role-options">
                        <!-- Опции ролей будут заполнены JavaScript -->
                        <div class="status warning">Сначала выберите игру на шаге 1</div>
                    </div>
                </div>
            </div>

            <!-- Шаг 4: Цель игры -->
            <div id="form-step-4" class="form-step hidden">
                <div class="card">
                    <h3>Цель игры</h3>
                    <p>С какой целью вы ищете тиммейтов?</p>
                    <div class="options">
                        <div class="option" data-value="ranked">Ранговые игры</div>
                        <div class="option" data-value="fun">Для развлечения</div>
                        <div class="option" data-value="training">Обучение/тренировка</div>
                        <div class="option" data-value="tournament">Турниры/соревнования</div>
                    </div>
                </div>
            </div>

            <!-- Кнопки навигации по шагам -->
            <div class="button-group">
                <button id="prev-step-btn" class="btn btn-secondary hidden">Назад</button>
                <button id="next-step-btn" class="btn">Далее</button>
            </div>
        </div>

        <!-- Экран поиска -->
        <div id="search-screen" class="screen">
            <h2>Поиск тиммейтов</h2>

            <div class="card">
                <p>Нажмите кнопку ниже, чтобы найти игроков с похожими предпочтениями.</p>

                <!-- Статус поиска -->
                <div id="search-status" class="status info hidden">
                    <span class="loader"></span> Идет поиск тиммейтов...
                </div>

                <!-- Результаты поиска -->
                <div id="search-results" class="player-list">
                    <!-- Результаты будут добавлены через JavaScript -->
                </div>

                <button id="search-btn" class="btn btn-success">Найти тиммейтов</button>
                <button id="refresh-search-btn" class="btn btn-secondary">Обновить результаты</button>
            </div>
        </div>

        <!-- Экран профиля -->
        <div id="profile-screen" class="screen">
            <h2>Мой профиль</h2>

            <!-- Информация о профиле -->
            <div class="card">
                <div id="profile-info">
                    <!-- Данные профиля будут заполнены через JavaScript -->
                    <p class="status info">У вас еще нет созданной анкеты. Заполните анкету на вкладке "Анкета".</p>
                </div>

                <!-- Кнопки управления профилем -->
                <div class="button-group">
                    <button id="edit-profile-btn" class="btn hidden">Редактировать анкету</button>
                    <button id="delete-profile-btn" class="btn btn-danger hidden">Удалить анкету</button>
                </div>
            </div>

            <!-- Статистика -->
            <div class="card">
                <h3>Статистика</h3>
                <p>Анкет создано сегодня: <strong id="profiles-today">0</strong></p>
                <p>Всего анкет в системе: <strong id="total-profiles">3</strong></p>
            </div>
        </div>
    </div>

    <!-- Нижняя панель навигации -->
    <div class="bottom-nav">
        <a href="#" class="nav-item" data-screen="search-screen">
            <div class="nav-icon">🔍</div>
            <div>Поиск</div>
        </a>
        <a href="#" class="nav-item" data-screen="form-screen">
            <div class="nav-icon">📝</div>
            <div>Анкета</div>
        </a>
        <a href="#" class="nav-item" data-screen="profile-screen">
            <div class="nav-icon">👤</div>
            <div>Профиль</div>
        </a>
    </div>

    <script>
        // ==============================================
        // ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ И НАСТРОЙКИ ПРИЛОЖЕНИЯ
        // ==============================================

        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;

        // Текущие данные пользователя
        let userProfile = {
            game: null,
            rank: null,
            role: null,
            goal: null,
            username: "Игрок",
            userId: null
        };

        // Текущий шаг анкеты
        let currentStep = 1;
        const totalSteps = 4;

        // Данные для анкеты
        const gameData = {
            dota2: {
                name: "Dota 2",
                ranks: ["Herald", "Guardian", "Crusader", "Archon", "Legend", "Ancient", "Divine", "Immortal"],
                roles: ["Керри", "Мид", "Оффлейнер", "Семисупора", "Саппорт", "Роумер"]
            },
            csgo: {
                name: "CS:GO",
                ranks: ["Silver I", "Silver II", "Silver III", "Silver IV", "Silver Elite", "Silver Elite Master",
                       "Gold Nova I", "Gold Nova II", "Gold Nova III", "Gold Nova Master",
                       "Master Guardian I", "Master Guardian II", "Master Guardian Elite",
                       "Distinguished Master Guardian", "Legendary Eagle", "Legendary Eagle Master",
                       "Supreme Master First Class", "Global Elite"],
                roles: ["Снайпер", "Рифлер", "Энтри", "Капитан", "Стратег", "Флекc"]
            },
            valorant: {
                name: "Valorant",
                ranks: ["Iron", "Bronze", "Silver", "Gold", "Platinum", "Diamond", "Ascendant", "Immortal", "Radiant"],
                roles: ["Дуэлянт", "Инициатор", "Контроллер", "Страж"]
            }
        };

        // Демонстрационные данные игроков (для тестирования)
        const demoPlayers = [
            {
                id: 1,
                name: "Alex",
                game: "dota2",
                rank: "Legend",
                role: "Керри",
                goal: "ranked",
                telegram: "@alex_player"
            },
            {
                id: 2,
                name: "Maria",
                game: "valorant",
                rank: "Platinum",
                role: "Дуэлянт",
                goal: "fun",
                telegram: "@maria_gamer"
            },
            {
                id: 3,
                name: "Ivan",
                game: "csgo",
                rank: "Master Guardian I",
                role: "Снайпер",
                goal: "training",
                telegram: "@ivan_csgo"
            },
            {
                id: 4,
                name: "Sergey",
                game: "dota2",
                rank: "Ancient",
                role: "Мид",
                goal: "ranked",
                telegram: "@sergey_dota"
            },
            {
                id: 5,
                name: "Olga",
                game: "valorant",
                rank: "Diamond",
                role: "Инициатор",
                goal: "tournament",
                telegram: "@olga_valorant"
            }
        ];

        // ==============================================
        // ФУНКЦИИ ДЛЯ РАБОТЫ С ДАННЫМИ
        // ==============================================

        // Сохранить профиль в LocalStorage
        function saveProfile() {
            try {
                localStorage.setItem('lfgBridgeProfile', JSON.stringify(userProfile));
                console.log("Профиль сохранен:", userProfile);
                return true;
            } catch (e) {
                console.error("Ошибка при сохранении профиля:", e);
                return false;
            }
        }

        // Загрузить профиль из LocalStorage
        function loadProfile() {
            try {
                const savedProfile = localStorage.getItem('lfgBridgeProfile');
                if (savedProfile) {
                    userProfile = JSON.parse(savedProfile);
                    console.log("Профиль загружен:", userProfile);
                    return true;
                }
            } catch (e) {
                console.error("Ошибка при загрузке профиля:", e);
            }
            return false;
        }

        // Удалить профиль из LocalStorage
        function deleteProfile() {
            try {
                localStorage.removeItem('lfgBridgeProfile');
                userProfile = {
                    game: null,
                    rank: null,
                    role: null,
                    goal: null,
                    username: "Игрок",
                    userId: null
                };
                console.log("Профиль удален");
                return true;
            } catch (e) {
                console.error("Ошибка при удалении профиля:", e);
                return false;
            }
        }

        // Проверить, заполнена ли анкета полностью
        function isProfileComplete() {
            return userProfile.game && userProfile.rank && userProfile.role && userProfile.goal;
        }

        // ==============================================
        // ФУНКЦИИ ДЛЯ РАБОТЫ С ЭКРАНАМИ
        // ==============================================

        // Переключение между экранами
        function showScreen(screenId) {
            // Скрыть все экраны
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Показать выбранный экран
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }

            // Обновить активную кнопку в навигации
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-screen') === screenId) {
                    item.classList.add('active');
                }
            });

            // Обновить данные на экране
            if (screenId === 'profile-screen') {
                updateProfileScreen();
            } else if (screenId === 'search-screen') {
                updateSearchScreen();
            } else if (screenId === 'form-screen') {
                updateFormScreen();
            }
        }

        // Обновить экран анкеты
        function updateFormScreen() {
            // Загрузить сохраненный профиль, если есть
            loadProfile();

            // Если профиль заполнен, показать данные
            if (isProfileComplete()) {
                // Установить выбранные опции
                setSelectedOption('form-step-1', userProfile.game);
                setSelectedOption('form-step-2', userProfile.rank);
                setSelectedOption('form-step-3', userProfile.role);
                setSelectedOption('form-step-4', userProfile.goal);

                // Перейти к 4 шагу, чтобы показать все заполненное
                currentStep = 4;
                updateStepIndicator();
                showStep(4);

                // Обновить текст кнопки
                document.getElementById('next-step-btn').textContent = 'Сохранить изменения';
            } else {
                // Начать с первого шага
                currentStep = 1;
                updateStepIndicator();
                showStep(1);
                document.getElementById('next-step-btn').textContent = 'Далее';
            }
        }

        // Обновить экран профиля
        function updateProfileScreen() {
            const profileInfo = document.getElementById('profile-info');

            if (isProfileComplete()) {
                // Получить название игры
                const gameName = gameData[userProfile.game] ? gameData[userProfile.game].name : userProfile.game;

                // Создать HTML для отображения профиля
                profileInfo.innerHTML = `
                    <h3>${userProfile.username}</h3>
                    <div class="player-details" style="margin-top: 15px;">
                        <div class="player-detail">🎮 ${gameName}</div>
                        <div class="player-detail">🏆 ${userProfile.rank}</div>
                        <div class="player-detail">👤 ${userProfile.role}</div>
                        <div class="player-detail">🎯 ${getGoalName(userProfile.goal)}</div>
                    </div>
                    <p style="margin-top: 15px; color: #81c784;">
                        ✅ Ваша анкета заполнена и видна другим игрокам!
                    </p>
                `;

                // Показать кнопку редактирования
                document.getElementById('edit-profile-btn').classList.remove('hidden');
                document.getElementById('delete-profile-btn').classList.remove('hidden');
            } else {
                profileInfo.innerHTML = `
                    <p class="status info">У вас еще нет созданной анкеты. Заполните анкету на вкладке "Анкета".</p>
                `;

                // Скрыть кнопки редактирования и удаления
                document.getElementById('edit-profile-btn').classList.add('hidden');
                document.getElementById('delete-profile-btn').classList.add('hidden');
            }

            // Обновить статистику
            updateStats();
        }

        // Обновить экран поиска
        function updateSearchScreen() {
            // Очистить предыдущие результаты
            const searchResults = document.getElementById('search-results');
            searchResults.innerHTML = '';

            // Скрыть статус поиска
            document.getElementById('search-status').classList.add('hidden');
        }

        // Получить название цели игры
        function getGoalName(goalKey) {
            const goals = {
                'ranked': 'Ранговые игры',
                'fun': 'Для развлечения',
                'training': 'Обучение/тренировка',
                'tournament': 'Турниры/соревнования'
            };
            return goals[goalKey] || goalKey;
        }

        // Обновить статистику
        function updateStats() {
            // Простая демонстрационная статистика
            document.getElementById('profiles-today').textContent = '1';
            document.getElementById('total-profiles').textContent = demoPlayers.length + 1;
        }

        // ==============================================
        // ФУНКЦИИ ДЛЯ РАБОТЫ С АНКЕТОЙ
        // ==============================================

        // Показать определенный шаг анкеты
        function showStep(stepNumber) {
            // Скрыть все шаги
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.add('hidden');
            });

            // Показать нужный шаг
            const stepElement = document.getElementById(`form-step-${stepNumber}`);
            if (stepElement) {
                stepElement.classList.remove('hidden');
            }

            // Обновить видимость кнопок
            document.getElementById('prev-step-btn').classList.toggle('hidden', stepNumber === 1);

            // Обновить текст кнопки "Далее"
            const nextBtn = document.getElementById('next-step-btn');
            if (stepNumber === totalSteps) {
                nextBtn.textContent = isProfileComplete() ? 'Сохранить изменения' : 'Сохранить анкету';
            } else {
                nextBtn.textContent = 'Далее';
            }

            // Если переходим к шагу 2 или 3, обновить опции
            if (stepNumber === 2) {
                loadRankOptions();
            } else if (stepNumber === 3) {
                loadRoleOptions();
            }
        }

        // Обновить индикатор шагов
        function updateStepIndicator() {
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (stepElement) {
                    stepElement.classList.remove('active', 'completed');

                    if (i === currentStep) {
                        stepElement.classList.add('active');
                    } else if (i < currentStep) {
                        stepElement.classList.add('completed');
                    }
                }
            }
        }

        // Перейти к следующему шагу
        function nextStep() {
            if (currentStep < totalSteps) {
                // Проверить, выбран ли вариант на текущем шаге
                if (!isOptionSelected(currentStep)) {
                    showStepMessage('Пожалуйста, выберите вариант перед переходом к следующему шагу.');
                    return;
                }

                currentStep++;
                updateStepIndicator();
                showStep(currentStep);
            } else {
                // Последний шаг - сохранить анкету
                if (!isOptionSelected(currentStep)) {
                    showStepMessage('Пожалуйста, выберите вариант перед сохранением анкеты.');
                    return;
                }

                saveProfile();
                showStepMessage('✅ Анкета успешно сохранена! Теперь вы можете искать тиммейтов.', 'success');
                setTimeout(() => {
                    showScreen('profile-screen');
                }, 1500);
            }
        }

        // Вернуться к предыдущему шагу
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepIndicator();
                showStep(currentStep);
            }
        }

        // Проверить, выбран ли вариант на текущем шаге
        function isOptionSelected(step) {
            if (step === 1) return userProfile.game !== null;
            if (step === 2) return userProfile.rank !== null;
            if (step === 3) return userProfile.role !== null;
            if (step === 4) return userProfile.goal !== null;
            return false;
        }

        // Показать сообщение на текущем шаге
        function showStepMessage(message, type = 'warning') {
            // Создать элемент сообщения
            const messageEl = document.createElement('div');
            messageEl.className = `status ${type}`;
            messageEl.textContent = message;
            messageEl.style.marginTop = '15px';
            messageEl.style.marginBottom = '0';

            // Найти текущий шаг и добавить сообщение
            const currentStepEl = document.getElementById(`form-step-${currentStep}`);
            if (currentStepEl) {
                // Удалить предыдущие сообщения
                const existingMessages = currentStepEl.querySelectorAll('.status.warning, .status.success');
                existingMessages.forEach(msg => msg.remove());

                // Добавить новое сообщение
                currentStepEl.appendChild(messageEl);

                // Убрать сообщение через 3 секунды
                if (type === 'warning') {
                    setTimeout(() => {
                        messageEl.remove();
                    }, 3000);
                }
            }
        }

        // Установить выбранную опцию
        function setSelectedOption(stepContainerId, value) {
            const container = document.getElementById(stepContainerId);
            if (!container) return;

            // Снять выделение со всех опций
            container.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });

            // Выделить опцию с соответствующим значением
            container.querySelectorAll('.option').forEach(option => {
                if (option.getAttribute('data-value') === value) {
                    option.classList.add('selected');
                }
            });
        }

        // Загрузить опции рангов на основе выбранной игры
        function loadRankOptions() {
            const rankOptions = document.getElementById('rank-options');
            rankOptions.innerHTML = '';

            // Проверить, выбрана ли игра
            if (!userProfile.game) {
                rankOptions.innerHTML = `
                    <div class="status warning">
                        Сначала выберите игру на шаге 1
                    </div>
                `;
                return;
            }

            // Загрузить ранги для выбранной игры
            if (userProfile.game && gameData[userProfile.game]) {
                gameData[userProfile.game].ranks.forEach(rank => {
                    const option = document.createElement('div');
                    option.className = 'option';
                    option.setAttribute('data-value', rank);
                    option.textContent = rank;

                    // Если этот ранг уже выбран в профиле, выделить его
                    if (userProfile.rank === rank) {
                        option.classList.add('selected');
                    }

                    // Добавить обработчик клика
                    option.addEventListener('click', function() {
                        // Снять выделение со всех опций
                        rankOptions.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        // Выделить выбранную опцию
                        this.classList.add('selected');

                        // Сохранить значение в профиль
                        userProfile.rank = this.getAttribute('data-value');

                        // Убрать сообщение об ошибке, если оно есть
                        const warningMessage = rankOptions.querySelector('.status.warning');
                        if (warningMessage) {
                            warningMessage.remove();
                        }
                    });

                    rankOptions.appendChild(option);
                });
            }
        }

        // Загрузить опции ролей на основе выбранной игры
        function loadRoleOptions() {
            const roleOptions = document.getElementById('role-options');
            roleOptions.innerHTML = '';

            // Проверить, выбрана ли игра
            if (!userProfile.game) {
                roleOptions.innerHTML = `
                    <div class="status warning">
                        Сначала выберите игру на шаге 1
                    </div>
                `;
                return;
            }

            // Загрузить роли для выбранной игры
            if (userProfile.game && gameData[userProfile.game]) {
                gameData[userProfile.game].roles.forEach(role => {
                    const option = document.createElement('div');
                    option.className = 'option';
                    option.setAttribute('data-value', role);
                    option.textContent = role;

                    // Если эта роль уже выбрана в профиле, выделить ее
                    if (userProfile.role === role) {
                        option.classList.add('selected');
                    }

                    // Добавить обработчик клика
                    option.addEventListener('click', function() {
                        // Снять выделение со всех опций
                        roleOptions.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        // Выделить выбранную опцию
                        this.classList.add('selected');

                        // Сохранить значение в профиль
                        userProfile.role = this.getAttribute('data-value');

                        // Убрать сообщение об ошибке, если оно есть
                        const warningMessage = roleOptions.querySelector('.status.warning');
                        if (warningMessage) {
                            warningMessage.remove();
                        }
                    });

                    roleOptions.appendChild(option);
                });
            }
        }

        // ==============================================
        // ФУНКЦИИ ДЛЯ ПОИСКА ТИММЕЙТОВ
        // ==============================================

        // Найти тиммейтов
        function findTeammates() {
            // Показать статус поиска
            const searchStatus = document.getElementById('search-status');
            searchStatus.classList.remove('hidden');

            // Очистить предыдущие результаты
            const searchResults = document.getElementById('search-results');
            searchResults.innerHTML = '';

            // Имитация задержки поиска
            setTimeout(() => {
                // Скрыть статус поиска
                searchStatus.classList.add('hidden');

                // Если анкета не заполнена, показать сообщение
                if (!isProfileComplete()) {
                    searchResults.innerHTML = `
                        <div class="status info">
                            <p>Сначала заполните свою анкету, чтобы найти подходящих тиммейтов.</p>
                            <button id="go-to-form-btn" class="btn btn-small" style="margin-top: 10px;">Заполнить анкету</button>
                        </div>
                    `;

                    // Добавить обработчик для кнопки перехода к анкете
                    document.getElementById('go-to-form-btn').addEventListener('click', () => {
                        showScreen('form-screen');
                    });
                    return;
                }

                // Найти подходящих игроков (простая логика)
                const matchedPlayers = demoPlayers.filter(player => {
                    // Ищем игроков в ту же игру
                    if (player.game !== userProfile.game) return false;

                    // Ищем игроков с похожей целью
                    if (player.goal !== userProfile.goal) return false;

                    return true;
                });

                // Если не найдено совпадений, показать всех игроков
                const playersToShow = matchedPlayers.length > 0 ? matchedPlayers : demoPlayers;

                // Отобразить найденных игроков
                if (playersToShow.length === 0) {
                    searchResults.innerHTML = `
                        <div class="status info">
                            <p>К сожалению, сейчас нет игроков для вашей игры. Попробуйте позже.</p>
                        </div>
                    `;
                } else {
                    playersToShow.forEach(player => {
                        const playerCard = createPlayerCard(player);
                        searchResults.appendChild(playerCard);
                    });

                    // Добавить статистику
                    const matchStats = document.createElement('div');
                    matchStats.className = 'status success';
                    matchStats.innerHTML = `
                        Найдено игроков: <strong>${playersToShow.length}</strong>
                        ${matchedPlayers.length > 0 ? ` (${matchedPlayers.length} с похожими целями)` : ''}
                    `;
                    searchResults.prepend(matchStats);
                }
            }, 1500); // Имитация задержки сети
        }

        // Создать карточку игрока
        function createPlayerCard(player) {
            const card = document.createElement('div');
            card.className = 'player-card';

            // Получить название игры
            const gameName = gameData[player.game] ? gameData[player.game].name : player.game;

            // Создать аватар с первой буквой имени
            const firstLetter = player.name.charAt(0).toUpperCase();

            card.innerHTML = `
                <div class="player-avatar">${firstLetter}</div>
                <div class="player-info">
                    <div class="player-name">${player.name}</div>
                    <div class="player-details">
                        <div class="player-detail">🎮 ${gameName}</div>
                        <div class="player-detail">🏆 ${player.rank}</div>
                        <div class="player-detail">👤 ${player.role}</div>
                        <div class="player-detail">🎯 ${getGoalName(player.goal)}</div>
                    </div>
                </div>
                <button class="btn btn-small contact-btn" data-telegram="${player.telegram}">Написать</button>
            `;

            return card;
        }

        // Открыть чат в Telegram
        function openTelegramChat(username) {
            // Проверяем, запущено ли приложение в Telegram
            if (tg.platform !== 'unknown') {
                // В Telegram Web App можно открыть диалог через tg.openTelegramLink
                tg.openTelegramLink(`https://t.me/${username.replace('@', '')}`);
            } else {
                // Если приложение запущено вне Telegram, открываем ссылку в новом окне
                window.open(`https://t.me/${username.replace('@', '')}`, '_blank');
            }
        }

        // ==============================================
        // ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ
        // ==============================================

        // Инициализация приложения
        function initApp() {
            console.log("LFG Bridge инициализирован");

            // Инициализация Telegram Web App
            tg.expand();
            tg.ready();

            // Получить данные пользователя из Telegram
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const tgUser = tg.initDataUnsafe.user;
                userProfile.username = tgUser.first_name || "Игрок";
                userProfile.userId = tgUser.id;

                // Если у пользователя есть username, добавить его
                if (tgUser.username) {
                    userProfile.username = `@${tgUser.username}`;
                }
            }

            // Загрузить сохраненный профиль
            loadProfile();

            // Настройка обработчиков событий

            // Кнопка "Начать" на экране приветствия
            document.getElementById('start-btn').addEventListener('click', () => {
                showScreen('form-screen');
            });

            // Кнопки навигации
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const screenId = item.getAttribute('data-screen');
                    showScreen(screenId);
                });
            });

            // Кнопки "Далее" и "Назад" в анкете
            document.getElementById('next-step-btn').addEventListener('click', nextStep);
            document.getElementById('prev-step-btn').addEventListener('click', prevStep);

            // Выбор опций в анкете (для шагов 1 и 4)
            document.querySelectorAll('#form-step-1 .option, #form-step-4 .option').forEach(option => {
                option.addEventListener('click', function() {
                    // Снять выделение со всех опций в этом контейнере
                    const container = this.closest('.form-step');
                    if (container) {
                        container.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        // Выделить выбранную опцию
                        this.classList.add('selected');

                        // Сохранить значение в профиль
                        const value = this.getAttribute('data-value');

                        if (container.id === 'form-step-1') {
                            userProfile.game = value;
                            // При смене игры сбрасываем ранг и роль
                            userProfile.rank = null;
                            userProfile.role = null;

                            // Если сейчас на шаге 2 или 3, обновить опции
                            if (currentStep === 2) {
                                loadRankOptions();
                            } else if (currentStep === 3) {
                                loadRoleOptions();
                            }
                        } else if (container.id === 'form-step-4') {
                            userProfile.goal = value;
                        }
                    }
                });
            });

            // Кнопка поиска тиммейтов
            document.getElementById('search-btn').addEventListener('click', findTeammates);

            // Кнопка обновления результатов поиска
            document.getElementById('refresh-search-btn').addEventListener('click', findTeammates);

            // Кнопка редактирования профиля
            document.getElementById('edit-profile-btn').addEventListener('click', () => {
                showScreen('form-screen');
            });

            // Кнопка удаления профиля
            document.getElementById('delete-profile-btn').addEventListener('click', () => {
                if (confirm('Вы уверены, что хотите удалить свою анкету?')) {
                    deleteProfile();
                    updateProfileScreen();
                    showStepMessage('✅ Анкета успешно удалена!', 'success');
                }
            });

            // Обработчик для кнопок "Написать" (добавляется динамически)
            document.addEventListener('click', function(e) {
                if (e.target && e.target.classList.contains('contact-btn')) {
                    const telegramUsername = e.target.getAttribute('data-telegram');
                    if (telegramUsername) {
                        openTelegramChat(telegramUsername);
                    }
                }
            });

            // Показать экран приветствия при первой загрузке
            showScreen('welcome-screen');

            // Обновить статистику
            updateStats();

            console.log("Приложение готово к работе");
        }

        // Запустить приложение после загрузки страницы
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>